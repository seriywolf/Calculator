<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>Calculator</title>      
</head>

<body>
    <h1>Calculator</h1>
    <div class="calculator">
        <div class="display">
            <div class="smallLCD"></div>
            <div class="bigLCD"></div>
        </div>
        <div class="buttons">
            <div  class="button reset">C</div>
            <div data-key="111" class="button math" id="/">/</div>
            <div data-key="106" class="button math" id="*">x</div>
            <div data-key="109" class="button math" id="-">-</div>
            <div class="sub1">
                <div data-key="103" class="button key" id="7">7</div>
                <div data-key="104" class="button key" id="8">8</div>
                <div data-key="105" class="button key" id="9">9</div>
                <div data-key="100" class="button key" id="4">4</div>
                <div data-key="101" class="button key" id="5">5</div>
                <div data-key="102" class="button key" id="6">6</div>
                <div data-key="97" class="button key" id="1">1</div>
                <div data-key="98" class="button key" id="2">2</div>
                <div data-key="99" class="button key" id="3">3</div>
                <div data-key="96" class="button key button0" id="0">0</div>
                <div data-key="110" class="button key" id=".">.</div>
            </div>
            <div class="vertical">
                <div data-key="107" class="button math" id="+">+</div>
                <div data-key="13" class="button enter">=</div>
            </div>
        </div>
    </div>


    <script>
        const add = (a, b) => {
            return a + b;
        };

        const subtract = (a, b) => {
            return a - b;
        };

        const multiply = (a, b) => {
            return a * b;
        };

        const divide = (a, b) => {
            return a / b;
        };

        function operate(operator, a, b) {
            return operator(a, b);
        };

        const bigLCD = document.querySelector(".bigLCD");
        bigLCD.textContent = 0;
        const smallLCD = document.querySelector(".smallLCD");


        let operator = "";
        let argument = "";
        let a = 0;
        let b = 0;
        let result;
        let check = false;

        window.addEventListener("keydown", pressButton);
        function pressButton(event) {
            const key = document.querySelector(`div[data-key="${event.keyCode}"]`);
            key.click();
            console.log(key);
        };

        //const buttons = Array.from(document.querySelectorAll('.button'));
        //buttons.forEach(button => button.addEventListener('transitionend', removeTransition));

        document.querySelectorAll(".button.key").forEach(item => {
            item.addEventListener("click", function (event) {
                const pressedKey = event.target.id;
                if (check) {
                    bigLCD.textContent = "0";
                    argument = "";
                    check = false;
                };
                //First check for double "."
                if (pressedKey === "." && argument.includes(".")) {
                    // Do nothing!!!
                    //Then check if pressed "." without digit before
                } else if (bigLCD.textContent === "0" && pressedKey === ".") {
                    bigLCD.textContent = "0" + pressedKey;
                    argument += "0" + pressedKey;
                } else if (bigLCD.textContent === "0") {
                    bigLCD.textContent = pressedKey;
                    argument += pressedKey;
                } else {
                    if (bigLCD.textContent.length < 12) {
                        bigLCD.textContent += pressedKey;
                        argument += pressedKey;
                    };
                };
            });
        });

        document.querySelectorAll(".button.math").forEach(item => {
            item.addEventListener("click", function (event) {
                check = true;
                operator = event.target.id;
                smallLCD.textContent += argument + operator;
                bigLCD.textContent = "0";
                if (a === 0) {
                    a = +argument;
                    argument = "";
                } else {
                    b = +argument;
                    argument = "";
                    operate();
                };
            });
        });


        function operate() {
            if (operator === "") {
                if (argument === "") {
                    result = 0;
                } else {
                    result = argument;
                };
            } else if (operator === "+") {
                result = add(a, b);
            } else if (operator === "-") {
                result = subtract(a, b);
            } else if (operator === "*") {
                result = multiply(a, b);
            } else if (operator === "/") {
                result = divide(a, b);
            };
            a = result;
            //Limit to number of  result digits to screen to 12
            let m = Math.pow(10, 12);
            result = Math.round(result * m) / m;
            bigLCD.textContent = result;
        };

        const enter = document.querySelector(".button.enter");
        enter.onclick = function () {
            b = +argument;
            if (operator === "/" && b === 0) {
                console.log(b);
                bigLCD.textContent = "ERROR";
            } else {
                smallLCD.textContent = "";
                operate();
            };
        };


        const resetButton = document.querySelector(".button.reset");
        resetButton.onclick = function () {
            bigLCD.textContent = 0;
            smallLCD.textContent = "";
            a = 0;
            b = 0;
            operator = "";
            argument = "";
            result = 0;
            check = false;
        };
    </script>
</body>

</html>